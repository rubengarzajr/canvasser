function initCanvasser(vari,datafile,dataForm,overrides){if(void 0==overrides&&(overrides=[]),"object"==typeof window[vari]&&"object"==typeof window[vari].act){if(void 0!==window[vari].act.videoList)for(var property1 in window[vari].act.videoList)window[vari].act.videoList[property1].pause();if(void 0!==window[vari].act.soundList)for(var property1 in window[vari].act.soundList)window[vari].act.soundList[property1].pause()}window[vari]&&(window[vari].act.loop=!1);var oldPos=window[vari]?{x:window[vari].act.position.x,y:window[vari].act.position.y}:{x:-1,y:-1};return window[vari]=new canvasser(vari,datafile,dataForm,overrides),void 0!==window[vari]&&(window[vari].act.position={x:oldPos.x,y:oldPos.y}),window[vari]}function canvasser(vari,interactiveData,dataForm,overrides){function init(data){if(overrides.forEach(function(override){subPropSet(data,Object.keys(override)[0],Object.values(override)[0])}),void 0!==data.settings){void 0===data.layers&&(data.layers=[{list:[],show:!0}],["objects","particles"].forEach(function(type){void 0!==data[type]&&data[type].forEach(function(item){data.layers[0].list.push({id:item.id,type:type,name:item.name})})})),void 0!==data.settings.fonts&&data.settings.fonts.forEach(function(font){if(void 0!==font.url&&!(document.head.innerHTML.indexOf(font.url)>-1)){if("link"===font.type){var link=document.createElement("link");link.href=font.url,link.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(link)}if("url"===font.type){var newcss="@font-face {font-family: "+font.family+"; src: url("+font.url+");}",style=document.createElement("style");style.appendChild(document.createTextNode(newcss)),document.getElementsByTagName("head")[0].appendChild(style)}}}),act.canvas=document.createElement("canvas"),act.canvasdom=document.getElementById(data.settings.canvasparent),act.context=act.canvas.getContext("2d"),act.canvas.width=data.settings.canvaswidth,act.canvas.height=data.settings.canvasheight,data.settings.responsive&&(act.canvas.style.maxWidth="100%",act.canvas.style.height="auto"),act.data=data,document.getElementById(data.settings.canvasparent).innerHTML="",document.getElementById(data.settings.canvasparent).appendChild(act.canvas),act.canvas.addEventListener("mousemove",getMousePos,!1),act.canvas.addEventListener("mousedown",mouseDown,!1),act.canvas.addEventListener("mouseup",mouseUp,!1),act.canvas.addEventListener("mouseleave",mouseLeave,!1),act.canvas.addEventListener("onmouseenter",mouseEnter,!1),act.canvas.addEventListener("touchstart",touchDown,!1),act.canvas.addEventListener("touchmove",touchMove,!1),act.canvas.addEventListener("touchend",touchUp,!1),act.data.paths&&act.data.paths.forEach(function(path){act.pathList[path.id]=path.url}),act.data.sounds&&act.data.sounds.forEach(function(sound){void 0!=sound.path&&(sound.url=act.pathList[sound.path]+"/"+sound.url),act.soundList[sound.id]=new Audio(sound.url)}),void 0===act.data.tests&&(act.data.tests=[]),act.data.images.forEach(function(image){if(image.deferred)act.imageList[image.id]={deferred:!0};else if(image.local){var tempImage=document.createElement("img");tempImage.src=image.data,imageObj.src="data:image;base64,"+btoa(image.data),act.imageList[image.id]={},act.imageList[image.id].imageData=tempImage,act.imageList[image.id].canvas=document.createElement("canvas"),act.imageList[image.id].canvas.width=tempImage.width,act.imageList[image.id].canvas.height=tempImage.height,act.imageList[image.id].context=act.imageList[image.id].canvas.getContext("2d"),act.imageList[image.id].context.drawImage(tempImage,0,0,imageObj.src.width,imageObj.src.height),image.atlas&&(act.imageList[image.id].atlas={},act.imageList[image.id].atlas.cellwidth=image.cellwidth,act.imageList[image.id].atlas.cellheight=image.cellheight,act.imageList[image.id].atlas.numX=Math.floor(imageObj.src.width/image.cellwidth),act.imageList[image.id].atlas.numY=Math.floor(imageObj.src.height/image.cellheight))}else loadImage(image,null,!1)}),void 0===act.data.videos&&(act.data.videos=[]),act.data.videos.forEach(function(video){video.deferred?act.videoList[video.id]={deferred:!0}:loadVideo(video,null,!1)}),void 0!==act.data.anims&&act.data.anims.forEach(function(anim){anim.autostart&&act.player.push(copyObj(anim,{}))}),void 0===act.data.constraints&&(act.data.constraints=[]);var externals=Array.from(document.querySelectorAll('[data-canvasser="'+vari+'"]'));externals.length>0&&externals.forEach(function(element){element.addEventListener("click",function(){window[vari].external(JSON.parse(element.getAttribute("data-canvasser-command")))})}),loop()}else console.log("Unable to load Canvasser.")}function tests(test){var goAll=!0;void 0!==test.testlist&&(test.testlist.forEach(function(subtest){if("position"===subtest.type){var item=act.data.objects.filter(function(obj){return obj.id===subtest.itemtocheck})[0],testp=act.data.objects.filter(function(obj){return obj.id===subtest.position})[0];if(void 0===act.imageList[item.image])return void(goAll=!1);var pos={x:item.position.current.x,y:item.position.current.y};if("center"===item.origin){var oPos={x:item.position.current.x,y:item.position.current.y};pos={x:Math.floor(oPos.x-act.imageList[item.image].imageData.naturalWidth/2*item.scale.current),y:Math.floor(oPos.y-act.imageList[item.image].imageData.naturalHeight/2*item.scale.current)}}0===getPixel({id:item.image,pos:{x:testp.position.current.x-pos.x,y:testp.position.current.y-pos.y}})[3]&&(goAll=!1)}if("var"===subtest.type){var thisVar=act.data.vars.filter(function(obj){return obj.id===subtest.itemtocheck})[0];if(void 0!==thisVar){var go=!1;"equal"===subtest.comparetype&&thisVar.value===subtest.value&&(go=!0),"greater"===subtest.comparetype&&thisVar.value>subtest.value&&(go=!0),"less"===subtest.comparetype&&thisVar.value<subtest.value&&(go=!0),go||(goAll=!1)}}}),goAll&&(test.trueoff&&(test.active=!1),act.actionList.push({mode:"true",obj:{truelist:test.truelist},next:!0})))}function loop(){function updateObject(obj){if(void 0!==obj){if(findParent(obj),"shape"===obj.type&&obj.show){var objParent=void 0!=obj.parent?obj.parent.object:void 0,currentShape=act.data.shapes.filter(function(shape){return shape.id===obj.shape})[0];void 0===obj.opacity&&(obj.opacity={current:1}),void 0===obj.opacity.current&&(obj.opacity.current=1),act.context.save(),act.context.globalAlpha=obj.opacity.current,obj.blend&&(act.context.globalCompositeOperation=obj.blend);var posCheck=drawShapes(act,objParent,obj.position.current,currentShape,obj.color,obj.testp,act.position,obj.scale.current,obj.usecolor);if(act.context.restore(),!obj.testp)return;posCheck&&"none"!==act.mode&&act.actionList.push({mode:act.mode,obj:obj})}if("image"===obj.type&&obj.show){if(void 0===act.imageList[obj.image])return;if(act.imageList[obj.image].deferred&&!act.imageList[obj.image].deferredStart){act.imageList[obj.image].deferredStart=!0;var imageLoad=act.data.images.filter(function(im){return im.id===obj.image})[0];void 0!==imageLoad&&loadImage(imageLoad,obj.image,!1)}if(void 0===act.imageList[obj.image].imageData)return;obj.parentTransform={position:{x:0,y:0},scale:1,rotation:0},void 0!==obj.parent&&void 0!==obj.parent.object&&(obj.parentTransform={position:{x:obj.parent.object.position.current.x,y:obj.parent.object.position.current.y},scale:obj.parent.object.scale.current,rotation:obj.parent.object.rotation});var pos={x:obj.position.current.x*obj.parentTransform.scale+obj.parentTransform.position.x,y:obj.position.current.y*obj.parentTransform.scale+obj.parentTransform.position.y},atlas=act.imageList[obj.image].atlas;(0===obj.scale.current||NaN===obj.scale.current||obj.scale.current<0)&&(obj.scale.current=.01),void 0===obj.originxy&&(obj.originxy={current:{x:0,y:0}}),void 0===obj.originxy.current&&(obj.originxy.current={x:0,y:0}),void 0===obj.originxy.current.x&&(obj.originxy.current.x=0),void 0===obj.originxy.current.y&&(obj.originxy.current.y=0);oxy={x:obj.originxy.current.x,y:obj.originxy.current.y};if(oxy="center"===obj.origin?atlas?{x:-Math.floor(atlas.cellwidth/2*obj.scale.current),y:-Math.floor(atlas.cellheight/2*obj.scale.current)}:{x:-Math.floor(act.imageList[obj.image].imageData.naturalWidth/2*obj.scale.current*obj.parentTransform.scale),y:-Math.floor(act.imageList[obj.image].imageData.naturalHeight/2*obj.scale.current*obj.parentTransform.scale)}:{x:-Math.floor(obj.originxy.current.x*obj.scale.current),y:-Math.floor(obj.originxy.current.y*obj.scale.current)},isNaN(pos.x)&&(console.log("x NaN"),pos.x=0),isNaN(pos.y)&&(console.log("y NaN"),pos.y=0),obj.show){if(void 0===obj.opacity&&(obj.opacity={current:1}),act.context.save(),act.context.globalAlpha=obj.opacity.current,obj.blend&&(act.context.globalCompositeOperation=obj.blend),act.context.translate(pos.x,pos.y),act.context.rotate(obj.rotation),act.context.translate(oxy.x,oxy.y),act.context.scale(obj.scale.current*obj.parentTransform.scale,obj.scale.current*obj.parentTransform.scale),atlas?(void 0===obj.atlascell&&(obj.atlascell={x:0,y:0}),void 0===obj.atlascell.x&&(obj.atlascell.x=0),void 0===obj.atlascell.y&&(obj.atlascell.y=0),act.context.drawImage(act.imageList[obj.image].imageData,atlas.cellwidth*obj.atlascell.x,atlas.cellheight*obj.atlascell.y,atlas.cellwidth,atlas.cellheight,0,0,atlas.cellwidth,atlas.cellheight,atlas.cellwidth,atlas.cellheight)):act.context.drawImage(act.imageList[obj.image].imageData,0,0,act.imageList[obj.image].imageData.naturalWidth,act.imageList[obj.image].imageData.naturalHeight),act.context.restore(),!obj.testp||"none"===act.mode)return;var pix=[0,0,0,0];obj.scale.current>.001&&("center"===obj.origin&&(obj.originxy.current.x=Math.floor(act.imageList[obj.image].imageData.naturalWidth/2),obj.originxy.current.y=Math.floor(act.imageList[obj.image].imageData.naturalHeight/2)),pix=getPixel({id:obj.image,pos:{x:Math.floor((act.position.x-pos.x+obj.originxy.current.x*obj.scale.current)/obj.scale.current),y:Math.floor((act.position.y-pos.y+obj.originxy.current.y*obj.scale.current)/obj.scale.current)}})),0!=pix[3]&&"none"!==act.mode?act.actionList.push({mode:act.mode,obj:obj}):null!==act.dragging&&obj.id===act.dragging.id&&act.actionList.push({mode:act.mode,obj:obj})}}if("video"===obj.type&&obj.show){if(void 0===act.videoList[obj.video])return;obj.parentTransform={position:{x:0,y:0},scale:1,rotation:0},void 0!==obj.parent&&void 0!==obj.parent.object&&(obj.parentTransform={position:{x:obj.parent.object.position.current.x,y:obj.parent.object.position.current.y},scale:obj.parent.object.scale.current,rotation:obj.parent.object.rotation});pos={x:obj.position.current.x*obj.parentTransform.scale+obj.parentTransform.position.x,y:obj.position.current.y*obj.parentTransform.scale+obj.parentTransform.position.y};(0===obj.scale.current||NaN===obj.scale.current||obj.scale.current<0)&&(obj.scale.current=.01),void 0===obj.originxy&&(obj.originxy={current:{x:0,y:0}}),void 0===obj.originxy.current&&(obj.originxy.current={x:0,y:0}),void 0===obj.originxy.current.x&&(obj.originxy.current.x=0),void 0===obj.originxy.current.y&&(obj.originxy.current.y=0);var oxy={x:obj.originxy.current.x,y:obj.originxy.current.y};oxy="center"===obj.origin?{x:-Math.floor(act.videoList[obj.video].videoWidth/2*obj.scale.current*obj.parentTransform.scale),y:-Math.floor(act.videoList[obj.video].videoHeight/2*obj.scale.current*obj.parentTransform.scale)}:{x:-Math.floor(obj.originxy.current.x*obj.scale.current),y:-Math.floor(obj.originxy.current.y*obj.scale.current)},isNaN(pos.x)&&(console.log("x NaN"),pos.x=0),isNaN(pos.y)&&(console.log("y NaN"),pos.y=0),void 0===obj.opacity&&(obj.opacity={current:1}),act.context.save(),act.context.globalAlpha=obj.opacity.current,obj.blend&&(act.context.globalCompositeOperation=obj.blend),act.context.translate(pos.x,pos.y),act.context.rotate(obj.rotation),act.context.translate(oxy.x,oxy.y),act.context.scale(obj.scale.current*obj.parentTransform.scale,obj.scale.current*obj.parentTransform.scale),act.context.drawImage(act.videoList[obj.video],0,0,act.videoList[obj.video].videoWidth,act.videoList[obj.video].videoHeight),act.context.restore()}}}act.data.tests.forEach(function(test){test.active&&tests(test)}),act.canvas.scale=act.canvas.scrollWidth/act.canvas.width,act.data.constraints.forEach(function(constraint){constraint.active&&constraint.driverlist.forEach(function(dr){if("position"===dr.type){if(void 0===dr.driver||void 0===dr.constrained||void 0===dr.axis||void 0===dr.operation||void 0===dr.value)return;var parent=act.data.objects.filter(function(obj){return obj.id===dr.driver})[0],child=act.data.objects.filter(function(obj){return obj.id===dr.constrained})[0];if(void 0===parent||void 0===child)return;void 0===dr.offset&&(dr.offset={x:0,y:0}),void 0===dr.offset.x&&(dr.offset.x=0),void 0===dr.offset.y&&(dr.offset.y=0);var modPos={x:modVal(dr.operation,parent.position.current.x,dr.value),y:modVal(dr.operation,parent.position.current.y,dr.value)};"x"!==dr.axis&&"xy"!==dr.axis||(child.position.current.x=modPos.x+dr.offset.x),"y"!==dr.axis&&"xy"!==dr.axis||(child.position.current.y=modPos.y+dr.offset.y)}if("lookat"===dr.type){var parent=act.data.objects.filter(function(obj){return obj.id===dr.driver})[0],child=act.data.objects.filter(function(obj){return obj.id===dr.constrained})[0];if(void 0===parent||void 0===child)return;var diff={x:parent.position.current.x-child.position.current.x,y:parent.position.current.y-child.position.current.y},vv=Math.sqrt(diff.x*diff.x+diff.y*diff.y),norm={x:diff.x/vv,y:diff.y/vv};void 0===dr.angle&&(dr.angle=0),void 0===child.rotation&&(child.rotation=0),child.rotation=3.1415926536-Math.atan2(norm.x,norm.y)+radians(dr.angle)}if("relation"===dr.type){var parent=act.data.objects.filter(function(obj){return obj.id===dr.driver})[0],child=act.data.objects.filter(function(obj){return obj.id===dr.constrained})[0];if(void 0===parent||void 0===child)return;var driver=0;driver=subPropGet(parent,dr.driverop),dr.useminmax&&(driver=(driver-dr.drivermin)/(dr.drivermax-dr.drivermin)*(dr.constrainmax-dr.constrainmin)+dr.constrainmin),subPropSet(child,dr.constrainop,driver)}})}),act.player.forEach(function(play){if(void 0===play.playing&&(play.playing=[]),void 0===play.nowStamp&&(play.reverse?play.nowStamp=Date.now()+30:play.nowStamp=Date.now()-30),void 0===play.timeActual&&(play.timeActual=1),void 0===play.time&&(play.time=1),void 0===play.speed&&(play.speed=1),play.prevStamp=play.nowStamp,play.prevTime=play.time,play.nowStamp=Date.now(),!play.pause){play.nowStamp-play.prevStamp<2e3&&(play.timeActual+=play.nowStamp-play.prevStamp,play.reverse?play.time=(play.length-play.timeActual)*play.speed:play.time=play.timeActual*play.speed);var deleteAnim=!1;if(!play.reverse&&play.time>=play.length&&(deleteAnim=!0),play.reverse&&play.time<=0&&(deleteAnim=!0),deleteAnim&&(play.delete=!0,play.loop)){var animToPlay=act.data.anims.filter(function(anim){return anim.id===play.id})[0];act.player.push(copyObj(animToPlay,{}))}void 0!=play.timelist&&play.timelist.forEach(function(animList){(animList.starttime<1||void 0===animList.starttime)&&(animList.starttime=1);var addAnim=!1;if(void 0===animList.endtime&&(animList.endtime=animList.starttime),!play.reverse&&animList.starttime>=play.prevTime&&animList.starttime<=play.time&&(addAnim=!0),play.reverse&&animList.endtime>=play.time&&animList.endtime<=play.prevTime&&(addAnim=!0),addAnim){var animCopy=copyObj(animList,{});play.playing.push(animCopy)}}),play.playing.forEach(function(anim){if("blend"===anim.type&&("group"===anim.filter?(groupObjs=findInGroup(anim.id)).forEach(function(animSubOb){animSubOb.blend=anim.mode}):void 0!==(animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0])&&(animOb.blend=anim.mode),anim.delete=!0),"flipbook"===anim.type){var animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0];void 0===anim.atlascell&&(anim.atlascell={x:0,y:0}),void 0===anim.atlascell.x&&(anim.atlascell.x=0),void 0===anim.atlascell.y&&(anim.atlascell.y=0),animOb&&(animOb.atlascell={x:anim.atlascell.x,y:anim.atlascell.y}),anim.delete=!0}if("layerassign"===anim.type){var layerNumber=-1;act.data.layers.forEach(function(layer,layerIdx){layer.id===anim.tolayer&&(layerNumber=layerIdx)});var found=!1;act.data.layers.forEach(function(layer,layerIdx){layer.list.forEach(function(item,itemIdx){if(!found&&item.id===anim.id){found=!0;var toMove=act.data.layers[layerIdx].list.splice(itemIdx,1)[0];"bottom"===anim.layerpos&&act.data.layers[layerNumber].list.splice(itemIdx,0,toMove),"top"===anim.layerpos&&act.data.layers[layerNumber].list.push(toMove)}})}),anim.delete=!0}if("loadinto"===anim.type&&(act.loop=!1,initCanvasser(anim.vari,anim.url,"file")),"play"===anim.type){var animToPlay=act.data.anims.filter(function(obj){return obj.id===anim.id})[0];act.player.push(copyObj(animToPlay,{})),anim.delete=!0}if("pstart"===anim.type&&(act.data.particles.forEach(function(obj){void 0!==obj.id&&obj.id===anim.id&&pManager.create(obj)}),anim.delete=!0),"sound"===anim.type&&(void 0!=anim.id&&act.soundList[anim.id].play(),anim.delete=!0),"soundstop"===anim.type&&(void 0!=anim.id&&(act.soundList[anim.id].pause(),act.soundList[anim.id].currentTime=0),anim.delete=!0),"testpset"===anim.type&&("group"===anim.filter?(groupObjs=findInGroup(anim.id)).forEach(function(animSubOb){animSubOb.testp=anim.testp}):void 0!==(animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0])&&(animOb.testp=anim.testp),anim.delete=!0),"videoplay"===anim.type&&(void 0!=anim.video&&(anim.play?act.videoList[anim.video].play():act.videoList[anim.video].pause(),anim.loop&&(act.videoList[anim.video].loop=!0),anim.current||checkSet(act.videoList[anim.video],"currentTime",anim.timestart,0),checkSet(act.videoList[anim.video],"playbackRate",anim.speed,0,10),checkSet(act.videoList[anim.video],"volume",anim.volume,0,1)),anim.delete=!0),"vis"===anim.type&&("group"===anim.filter?(groupObjs=findInGroup(anim.id)).forEach(function(animSubOb){animSubOb.show=anim.show}):void 0!==(animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0])&&(animOb.show=anim.show),anim.delete=!0),void 0!==anim.endtime&&anim.endtime<play.time){if(void 0===(animOb=getAnimItem(anim)))return;if("fade"===anim.type&&("group"===anim.filter?(groupObjs=findInGroup(anim.id)).forEach(function(animSubOb){void 0===animSubOb.opacity&&(animSubOb.opacity={current:0}),animSubOb.opacity.current=anim.endalpha}):void 0!=(animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0])&&(void 0===animOb.opacity&&(animOb.opacity={current:0}),void 0===anim.endalpha&&(anim.endalpha=0),animOb.opacity.current=anim.endalpha)),"move"===anim.type&&void 0!=anim.endpos)if("group"===anim.filter){var groupObjs=findInGroup(animOb.id);groupObjs.forEach(function(animSubOb){animSubOb.position.current={x:anim.endpos.x,y:anim.endpos.y}})}else animOb.position.current={x:anim.endpos.x,y:anim.endpos.y};"turn"===anim.type&&(animOb.rotation=radians(anim.endrot),anim.fromCurrentStart=void 0),anim.delete=!0}}),play.playing=play.playing.filter(function(anim){return!anim.delete}),play.playing.forEach(function(anim){var animOb=getAnimItem(anim);if(void 0!==animOb){if("fade"===anim.type)if(void 0===anim.startalpha&&(anim.startalpha=0),void 0===anim.endalpha&&(anim.endalpha=0),"group"===anim.filter)(groupObjs=findInGroup(anim.id)).forEach(function(animSubOb){void 0===animSubOb.opacity&&(animSubOb.opacity={current:0}),anim.fromcurrent&&(anim.startalpha=animSubOb.opacity.current);var percent=(play.time-anim.starttime)/(anim.endtime-anim.starttime),alphaDiff=(anim.endalpha-anim.startalpha)*percent+anim.startalpha;animSubOb.opacity.current=alphaDiff});else{void 0===(animOb=act.data.objects.filter(function(obj){return obj.id===anim.id})[0]).opacity&&(animOb.opacity={current:0}),anim.fromcurrent&&(anim.startalpha=animOb.opacity.current);var percent=(play.time-anim.starttime)/(anim.endtime-anim.starttime),alphaDiff=(anim.endalpha-anim.startalpha)*percent+anim.startalpha;void 0!=animOb&&(void 0===animOb.opacity&&(animOb.opacity={current:0}),void 0===anim.endalpha&&(anim.endalpha=0),animOb.opacity.current=alphaDiff)}if("move"===anim.type){anim.fromcurrent&&(anim.startpos={x:animOb.position.current.x,y:animOb.position.current.y}),void 0===anim.startpos&&(anim.startpos={x:0,y:0}),void 0===anim.endpos&&(anim.endpos={x:0,y:0}),isNaN(anim.startpos.x)&&(anim.startpos.x=0),isNaN(anim.startpos.y)&&(anim.startpos.y=0),isNaN(anim.endpos.x)&&(anim.endpos.x=0),isNaN(anim.endpos.y)&&(anim.endpos.y=0);var percent=(play.time-anim.starttime)/(anim.endtime-anim.starttime),t=play.time-anim.starttime,d=anim.endtime-anim.starttime;void 0===anim.ease&&(anim.ease="linear");var posDiff={x:ease[anim.ease](t,anim.startpos.x,anim.endpos.x-anim.startpos.x,d),y:ease[anim.ease](t,anim.startpos.y,anim.endpos.y-anim.startpos.y,d)};if(isNaN(posDiff.x)&&console.log("posDiff x NaN"),isNaN(posDiff.y)&&console.log("posDiff y NaN"),"group"===anim.filter){var groupObjs=findInGroup(animOb.id);groupObjs.forEach(function(animSubOb){animSubOb.position.current={x:Math.round(posDiff.x),y:Math.round(posDiff.y)}})}else animOb.position.current={x:Math.round(posDiff.x),y:Math.round(posDiff.y)}}if("scale"===anim.type){objs=[animOb];"group"===anim.filter&&(objs=findInGroup(animOb.id)),objs.forEach(function(animSubOb){(void 0===anim.startscale||anim.fromcurrent)&&(anim.startscale=animSubOb.scale.current);play.time,anim.starttime,anim.endtime,anim.starttime;var t=play.time-anim.starttime,d=anim.endtime-anim.starttime;void 0===anim.ease&&(anim.ease="linear");var scaleDiff=ease[anim.ease](t,anim.startscale,anim.endscale-anim.startscale,d);animSubOb.scale.current=scaleDiff})}if("turn"===anim.type){var objs=[animOb];"group"===anim.filter&&(objs=findInGroup(animOb.id)),objs.forEach(function(animSubOb){void 0===animSubOb.rotation&&(animSubOb.rotation=0);var startrot=0,endrot=radians(anim.endrot);anim.fromcurrent?void 0==anim.fromCurrentStart?(startrot=animSubOb.rotation,anim.fromCurrentStart=startrot):startrot=anim.fromCurrentStart:void 0!==anim.startrot&&(startrot=radians(anim.startrot));play.time,anim.starttime,anim.endtime,anim.starttime;var t=play.time-anim.starttime,d=anim.endtime-anim.starttime;void 0===anim.ease&&(anim.ease="linear");var rotDiff=ease[anim.ease](t,startrot,endrot-startrot,d);animSubOb.rotation=rotDiff})}}})}}),act.player=act.player.filter(function(play){return!play.delete}),"true"===act.mode&&(act.mode="none"),act.mouseDown?(act.mouseDownCnt++,act.position.x!==act.prevPosition.x&&act.position.y!==act.prevPosition.y&&act.mouseDownCnt>2&&(act.mode="drag",act.canvas.style.cursor="move")):act.canvas.style.cursor="default",act.context.clearRect(0,0,act.canvas.width,act.canvas.height),pManager.update(),act.data.layers.forEach(function(layer){layer.show&&layer.list.forEach(function(item){"particles"===item.type&&pManager.draw(item.id),"objects"===item.type&&updateObject(act.data.objects.filter(function(obj){return obj.id===item.id})[0])})}),actions(),act.prevPosition={x:act.position.x,y:act.position.y},"drop"===act.mode&&mouseLeave(),act.loop&&window.requestAnimationFrame(loop)}function drawShapes(act,parent,pos,shapeData,color,doTest,testP,scale,usecolor){if(void 0!==color&&(void 0===color.current&&(color.current=["rgb(0,0,0,1)"]),void 0!==shapeData)){var ctx=act.context,test=!1,colorIndex=0,par={x:0,y:0,scale:1};void 0!==parent&&(par={x:parent.position.current.x,y:parent.position.current.y,scale:parent.scale.current});var origin={x:parseInt(pos.x*par.scale+par.x),y:parseInt(pos.y*par.scale+par.y)},sizer=scale*par.scale;return ctx.beginPath(),void 0===shapeData.drawcode&&(shapeData.drawcode=[]),shapeData.drawcode.forEach(function(shape){function processText(shape){void 0===origin&&(origin={x:0,y:0});var offset={x:0,y:0};void 0!=shape.offset&&(void 0!==shape.offset.x&&(offset.x=shape.offset.x),void 0!==shape.offset.y&&(offset.y=shape.offset.y));var size=1,height=0;void 0!==shape.size&&(size=shape.size),void 0!==shape.height&&(height=shape.height),shape.font&&(ctx.font=size*sizer+"px "+shape.font),void 0===shape.text&&(shape.text="");String(shape.text).replace(/\{{(.+?)\}}/g,function(match,p1,p2,p3,offset,string){var val=act.data.vars.filter(function(obj){return obj.name===p1})[0];if(void 0!==val)return val.value}).split("\n").forEach(function(line,idx){var adjust=0;"textline"===shape.type&&(ctx.lineWidth=shape.width,usecolor?ctx.strokeStyle=color.current[colorIndex]:void 0!==shape.color&&(ctx.strokeStyle=shape.color),width=ctx.measureText(line).width,"right"===shape.justify&&(adjust=Math.floor(-width)),"center"===shape.justify&&(adjust=Math.floor(-width/2)),ctx.strokeText(line,origin.x+adjust+offset.x*sizer,origin.y+height*idx+offset.y*sizer)),"textfill"===shape.type&&(usecolor?ctx.fillStyle=color.current[colorIndex]:void 0!==shape.color&&(ctx.fillStyle=shape.color),width=ctx.measureText(line).width,"right"===shape.justify&&(adjust=Math.floor(-width)),"center"===shape.justify&&(adjust=Math.floor(-width/2)),ctx.fillText(line,origin.x+adjust+offset.x*sizer,origin.y+height*idx+offset.y*sizer))})}var offset={x:0,y:0};void 0!==shape.offset&&(void 0!==shape.offset.x&&(offset.x=shape.offset.x),void 0!==shape.offset.y&&(offset.y=shape.offset.y)),"arc"===shape.type&&(void 0===shape.startangle&&(shape.startangle=0),void 0===shape.endangle&&(shape.endangle=0),ctx.arc(origin.x+offset.x*sizer,origin.y+offset.y*sizer,shape.radius*sizer,radians(shape.startangle),radians(shape.endangle),shape.counterclockwise),shape.stroke&&(void 0!==shape.linecolor&&(ctx.strokeStyle=shape.linecolor),void 0!==shape.linewidth&&(ctx.lineWidth=shape.linewidth),ctx.stroke()),shape.fill&&(void 0!==shape.fillcolor&&(ctx.fillStyle=shape.fillcolor),ctx.fill())),"bcurve"===shape.type&&ctx.bezierCurveTo(origin.x+offseta.x*sizer,origin.y+offseta.y*sizer,origin.x+offsetb.x*sizer,origin.y+offsetb.y*sizer,origin.x+offsetc.x*sizer,origin.y+offsetc.y*sizer),"fill"===shape.type&&(usecolor&&(ctx.fillStyle=color.current[colorIndex]),ctx.fill()),"fillcolor"===shape.type&&(ctx.fillStyle=shape.color),"line"===shape.type&&ctx.lineTo(origin.x+offset.x*sizer,origin.y+offset.y*sizer),"linewidth"===shape.type&&(ctx.lineWidth=shape.width*sizer),"move"===shape.type&&ctx.moveTo(origin.x+offset.x*sizer,origin.y+offset.y*sizer),"rect"===shape.type&&(ctx.beginPath(),ctx.rect(origin.x+offset.x*sizer,origin.y+offset.y*sizer,shape.width*sizer,shape.height*sizer),shape.stroke&&(void 0!==shape.linecolor&&(ctx.strokeStyle=shape.linecolor),void 0!==shape.linewidth&&(ctx.lineWidth=shape.linewidth),ctx.stroke()),shape.fill&&(void 0!==shape.fillcolor&&(ctx.fillStyle=shape.fillcolor),ctx.fill()),ctx.closePath()),"textfill"===shape.type&&processText(shape),"textline"===shape.type&&processText(shape),"strokecolor"===shape.type&&(ctx.strokeStyle=shape.color),"stroke"===shape.type&&ctx.stroke(),"ptest"===shape.type&&doTest&&ctx.isPointInPath(testP.x,testP.y)&&(test=!0),"close"===shape.type&&ctx.closePath(),"begin"===shape.type&&(ctx.beginPath(),colorIndex++)}),ctx.closePath(),test}}function loadImage(image,deferred,loadNew){var forceLoad=!act.data.settings.usecache;loadNew&&(forceLoad=!0);var imageObj=new Image;imageObj.setAttribute("crossOrigin","anonymous"),imageObj.src=(void 0!=image.path?act.pathList[image.path]+"/"+image.url:image.url)+(forceLoad?"?"+(new Date).getTime():""),imageObj.onload=function(){act.imageList[image.id]={},act.imageList[image.id].imageData=this,act.imageList[image.id].canvas=document.createElement("canvas"),act.imageList[image.id].canvas.width=this.width,act.imageList[image.id].canvas.height=this.height,act.imageList[image.id].context=act.imageList[image.id].canvas.getContext("2d"),act.imageList[image.id].context.drawImage(this,0,0,this.width,this.height),image.atlas&&(act.imageList[image.id].atlas={},act.imageList[image.id].atlas.cellwidth=image.cellwidth,act.imageList[image.id].atlas.cellheight=image.cellheight,act.imageList[image.id].atlas.numX=Math.floor(this.width/image.cellwidth),act.imageList[image.id].atlas.numY=Math.floor(this.height/image.cellheight));try{act.imageList[image.id].context.getImageData(0,0,1,1).data}catch(err){act.imageList[image.id].tainted=!0}null!==deferred&&(delete act.imageList[deferred].deferred,delete act.imageList[deferred].deferredStart)}}function loadVideo(video,deferred,loadNew){videosrc=void 0!=video.path?act.pathList[video.path]+"/"+video.url:video.url,void 0===act.videoList[video.id]&&(act.videoList[video.id]=document.createElement("video"),act.videoList[video.id].src=videosrc)}function modVal(operation,startVal,val){return"add"===operation?startVal+val:"subtract"===operation?startVal-val:"multiply"===operation?startVal*val:"divide"===operation?startVal/val:void 0}function actions(){var clickList={},objList=[],topClick=void 0;if(act.actionList.length>0){for(var actIdx=act.actionList.length;actIdx--;)act.actionList[actIdx]&&(objList.push(act.actionList[actIdx].obj.id),clickList[act.actionList[actIdx].obj.id]=act.actionList[actIdx],act.actionList.splice(actIdx,1));act.data.layers.forEach(function(layer){layer.list.forEach(function(obj){objList.includes(obj.id)&&(topClick=obj.id)})}),act.actionList.push(clickList[topClick])}act.actionList.forEach(function(over){void 0!==over.obj[over.mode+"list"]&&over.obj[over.mode+"list"].forEach(function(action){if("cleardown"===action.type&&(act.mode="none"),"console"===action.type&&console.log(action.text),"conditional"===action.type){if("position"===action.check){var item=act.data.objects.filter(function(obj){return obj.id===action.itemtocheck})[0],testp=act.data.objects.filter(function(obj){return obj.id===action.position})[0],pos={x:item.position.current.x,y:item.position.current.y};if("center"===item.origin){var oPos={x:item.position.current.x,y:item.position.current.y};pos={x:Math.floor(oPos.x-act.imageList[item.image].imageData.naturalWidth/2*item.scale.current),y:Math.floor(oPos.y-act.imageList[item.image].imageData.naturalHeight/2*item.scale.current)}}0!=getPixel({id:item.image,pos:{x:testp.position.current.x-pos.x,y:testp.position.current.y-pos.y}})[3]?act.actionList.push({mode:"true",obj:testp,next:!0}):act.actionList.push({mode:"false",obj:testp,next:!0})}if("var"===action.check){var thisVar=act.data.vars.filter(function(obj){return obj.id===action.itemtocheck})[0];if(void 0!==thisVar){var go=!1;"number"===thisVar.type&&(void 0===action.value&&(action.value=0),thisVar.value=Number(thisVar.value),action.value=Number(action.value)),"equal"===action.comparetype&&thisVar.value===action.value&&(go=!0),"greater"===action.comparetype&&thisVar.value>action.value&&(go=!0),"less"===action.comparetype&&thisVar.value<action.value&&(go=!0),go?act.actionList.push({mode:"true",obj:over.obj,next:!0}):act.actionList.push({mode:"false",obj:over.obj,next:!0})}}}if("copyelement"===action.type){var target=document.getElementById(action.target),source=document.getElementById(action.source);void 0!==target&&void 0!==source&&null!==target&&null!==source&&(target.innerHTML=source.innerHTML)}if("execute"===action.type&&window[action.function](action.params),"function"===action.type&&window[action.function]({id:action.id}),"increment"===action.type&&act.data.objects.forEach(function(obj){if(checkAction(action,obj)){var amt=Number(subPropGet(obj,action.prop))+Number(action.newvalue);action.rangemin&&amt<Number(action.rangemin)||action.rangemax&&amt>Number(action.rangemax)||subPropSet(obj,action.prop,amt.toString())}}),"loadinto"===action.type&&(act.loop=!1,initCanvasser(action.vari,action.url,"file")),"loadpage"===action.type)if(action.newpage){void 0===action.backcolor&&(action.backcolor="black"),void 0===action.textcolor&&(action.backcolor="white");var goDiv=document.getElementById("canvasserLoadPageInNewTab");null!==goDiv&&goDiv.parentNode.removeChild(goDiv),(goDiv=document.createElement("div")).style="width: 100%;height: 100%;background-color: "+action.backcolor+";left: 0px;top: 0px;position: absolute;",goDiv.id="canvasserLoadPageInNewTab",act.canvasdom.appendChild(goDiv),goDiv2=document.createElement("div"),goDiv2.style="width: 100%;height: 100%;display: table;",goDiv.appendChild(goDiv2);var button=document.createElement("a");button.innerHTML=action.message+"<br>"+(action.showurl?action.url:""),button.style="color:"+action.textcolor+";display: table-cell;vertical-align: middle;text-align: center;",button.href=action.url,button.target="_blank",goDiv2.appendChild(button),button.onclick=function(){goDiv.parentNode.removeChild(goDiv)}}else window.location.href=action.url;if("pauseanim"===action.type){var animPlaying=act.player.filter(function(obj){return obj.id===action.animation})[0];void 0!==animPlaying&&(void 0===animPlaying.pause&&(animPlaying.pause=!1),action.toggle?animPlaying.pause=!animPlaying.pause:animPlaying.pause=!0)}if("playanim"===action.type){var animToPlay=act.data.anims.filter(function(obj){return obj.id===action.animation})[0];act.player.push(copyObj(animToPlay,{}))}if("modvar"===action.type){var varChange=act.data.vars.filter(function(obj){return obj.id===action.id})[0];"add"===action.operation&&(varChange.value=Number(varChange.value)+Number(action.amount)),"sub"===action.operation&&(varChange.value=Number(varChange.value)-Number(action.amount)),"set"===action.operation&&(varChange.value="number"===varChange.type?Number(action.amount):action.amount,"boolean"===varChange.type&&(varChange.type="true"===action.amount))}if("swapimage"===action.type&&act.data.objects.forEach(function(obj){void 0!==obj.id&&obj.id===action.id&&(obj.image=action.image)}),"moveobject"===action.type&&act.data.objects.forEach(function(obj){void 0!==obj.id&&obj.id===action.id&&("absolute"===action.frame&&(obj.position.current={x:action.amount.x,y:action.amount.y}),"relative"===action.frame&&(obj.position.current.x+=action.amount.x,obj.position.current.y+=action.amount.y))}),"pstart"===action.type&&act.data.particles.forEach(function(obj){void 0!==obj.id&&obj.id===action.id&&pManager.create(obj)}),"scale"===action.type&&act.data.objects.forEach(function(obj){checkAction(action,obj)&&("increment"===action.frame&&(obj.scale.current+=action.amount),"multiply"===action.frame&&(obj.scale.current=obj.scale.current*action.amount),"absolute"===action.frame&&(obj.scale.current=action.amount))}),"set"===action.type&&act.data.objects.forEach(function(obj){checkAction(action,obj)&&subPropSet(obj,action.prop,action.newvalue.toString())}),"shapecolor"===action.type&&act.data.objects.forEach(function(obj){checkAction(action,obj)&&("default"===action.source&&(obj.color=obj.defaultcolor),"hover"===action.source&&(obj.color=obj.hovercolor),"selectcolor"===action.source&&(obj.color=obj.selectcolor),"value"===action.source&&(obj.color=action.color))}),"slideobject"===action.type){filter="object";void 0!==action.filter&&(filter=action.filter),act.data.objects.forEach(function(obj){if(void 0!==action.id){if("group"!==filter){if(void 0===obj.id)return;if(null!==act.dragging&&obj.id!==act.dragging.id)return;if(obj.id!==action.id)return;act.dragging=obj}if("group"!==filter||void 0!==obj.groups.find(function(e){return e.id===action.id})){if(void 0!==obj.parent?(void 0===obj.position.offset&&(obj.position.offset={x:obj.position.current.x,y:obj.position.current.y}),action.constrainx||(obj.position.current.x+=act.position.x-act.prevPosition.x),action.constrainy||(obj.position.current.y+=act.position.y-act.prevPosition.y)):(action.constrainx||(obj.position.current.x+=act.position.x-act.prevPosition.x),action.constrainy||(obj.position.current.y+=act.position.y-act.prevPosition.y)),action.limitx&&(obj.position.current.x<action.minx&&(obj.position.current.x=action.minx),obj.position.current.x>action.maxx&&(obj.position.current.x=action.maxx),action.usebounds&&"image"===obj.type)){var dimX=act.imageList[obj.image].canvas.width*obj.scale.current;obj.position.current.x+dimX>action.maxx&&(obj.position.current.x=action.maxx-dimX)}if(action.limity&&(obj.position.current.y<action.miny&&(obj.position.current.y=action.miny),obj.position.current.y>action.maxy&&(obj.position.current.y=action.maxy),action.usebounds&&"image"===obj.type)){var dimY=act.imageList[obj.image].canvas.height*obj.scale.current;obj.position.current.y+dimY>action.maxy&&(obj.position.current.y=action.maxy-dimY)}}}})}if("slideover"===action.type&&console.log("slideOver"),"sound"===action.type&&act.soundList[action.id].play(),"testpset"===action.type){var filter="object";void 0!==action.filter&&(filter=action.filter),"group"===filter?findInGroup(action.id).forEach(function(obj){obj.testp=action.testp}):act.data.objects.filter(function(obj){return obj.id===action.id})[0].testp=action.testp}if("textentry"===action.type){var scaleAmt=1;parseInt(sample.act.canvasdom.style.width)<act.data.settings.canvaswidth&&(scaleAmt=parseInt(sample.act.canvasdom.style.width)/act.data.settings.canvaswidth),void 0===action.style&&(action.style="");var holder=document.getElementById(act.data.settings.canvasparent),text=document.getElementById(act.data.settings.canvasparent+"_text_input"),actVari=act.data.vars.filter(function(obj){return obj.id===action.vari})[0],canvasPos=act.canvas.getBoundingClientRect();void 0===action.position&&(action.position={x:0,y:0}),void 0===action.position.x&&(action.position.x=0),void 0===action.position.y&&(action.position.y=0);var abs={x:canvasPos.left+action.position.x*scaleAmt,y:canvasPos.top+action.position.y*scaleAmt};action.overcursor&&(abs={x:canvasPos.left+act.position.x*scaleAmt,y:canvasPos.top+act.position.y*scaleAmt}),text=document.createElement("input");var varType="text";void 0===actVari.type&&(actVari.type="text"),"number"===actVari.type&&(varType="number"),text.setAttribute("type",varType),text.value=actVari.value,text.id=act.data.settings.canvasparent+"_text_input",text.style="position:absolute;"+action.style,text.style.left="0px",text.style.top="0px",holder.appendChild(text);var textPos=text.getBoundingClientRect(),diff={x:abs.x-textPos.left-textPos.width/2,y:abs.y-textPos.top-textPos.height/2};text.style.left=diff.x+"px",text.style.top=diff.y+"px",text.focus(),text.addEventListener("blur",function(e){document.getElementById(act.data.settings.canvasparent+"_text_input").remove(),e.target.removeEventListener(e.type,arguments.callee)},!1),text.addEventListener("input",function(e){actVari.value=text.value},!1),text.addEventListener("keydown",function(e){"Enter"===event.key&&document.getElementById(act.data.settings.canvasparent+"_text_input").blur()},!1)}"url"===action.type&&void 0!=(target=document.getElementById(action.target))&&loadInPlace(action.url,target),"vis"===action.type&&act.data.objects.forEach(function(obj){checkAction(action,obj)&&(obj.show=action.show)})})}),act.actionList=act.actionList.filter(function(action){return action.next}),act.actionList.forEach(function(action){delete action.next})}function appendToArray(inArray){var newArr=[];return inArray.forEach(function(element){"object"==typeof element?Array.isArray(element)?newArr.push(appendToArray(element)):newArr.push(copyObj(element,{})):newArr.push(element)}),newArr}function checkAction(action,obj){if(void 0===action.filter)return!1;if("group"===action.filter){if(void 0===obj.groups)return!1;if(void 0===obj.groups.find(function(item){return item.id===action.id}))return!1}return"object"!==action.filter||obj.id===action.id}function checkSet(check,prop,set,min,max){void 0!==check&&void 0!==prop&&void 0!==set&&(void 0!==min&&set<min&&(set=min),void 0!==max&&set>max&&(set=max),check[prop]=set)}function copyObj(object,newObj){for(var key in object)object.hasOwnProperty(key)&&("object"==typeof object[key]?Array.isArray(object[key])?newObj[key]=appendToArray(object[key]):newObj[key]=copyObj(object[key],{}):newObj[key]=object[key]);return newObj}function findInGroup(groupName){return act.data.objects.filter(function(obj){if(void 0!==obj.groups){var hasId=!1;return obj.groups.forEach(function(subObj){subObj.id===groupName&&(hasId=!0)}),!!hasId||void 0}})}function findParent(item){if(void 0!==item.parent&&void 0===item.parent.object){var parentObj=act.data.objects.filter(function(parent){return parent.id===item.parent.id})[0];void 0!==parentObj&&(item.parent.object=parentObj)}}function getAnimItem(anim){void 0===anim.filter&&(anim.filter="object");var filter="objects";void 0!=anim.filter&&(filter=anim.filter+"s");var animOb=act.data[anim.filter+"s"].filter(function(item){return item.id===anim.id})[0];return"particles"===filter&&(animOb=pManager.getSystem(anim.id)),animOb}function getMagnitude(vector){return Math.sqrt(vector.x*vector.x+vector.y*vector.y)}function getMousePos(event){var rect=act.canvas.getBoundingClientRect();act.position={x:(event.clientX-rect.left)/act.canvas.scale,y:(event.clientY-rect.top)/act.canvas.scale}}function getObjById(id){return act.data.objects.filter(function(obj){return obj.id===id})[0]}function getPixel(image){return act.imageList[image.id].tainted?(loadImage(act.data.images.filter(function(im){return im.id===image.id})[0],null,!0),[0,0,0,0]):act.imageList[image.id].context.getImageData(image.pos.x,image.pos.y,1,1).data}function getUnit(vector){var mag=getMagnitude(vector);return{x:vector.x/mag,y:vector.y/mag}}function loadInPlace(url,place){var fileToDl=url;!1===act.data.settings.usecache&&(fileToDl+="?"+(new Date).getTime());var oReq=new XMLHttpRequest;oReq.addEventListener("load",function(){place.innerHTML=this.responseText}),oReq.open("GET",fileToDl),oReq.send()}function mouseDown(){act.mode="click",act.external=!1,act.mouseDown=!0,act.mouseDownCnt=0}function mouseUp(){act.mode="none",act.mouseDown=!1,act.mouseDownCnt=0,null!==act.dragging&&(act.mode="drop",act.dragging=null)}function mouseEnter(){act.mode="none",act.mouseDown=!1,act.mouseDownCnt=0}function mouseLeave(){act.mode="none",act.mouseDown=!1,act.mouseDownCnt=0,act.dragging=null}function radians(degrees){return.01745329251994*degrees}function randInterval(min,max){return Math.random()*(max-min)+min}function randIntervalInt(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function subPropGet(obj,desc){for(var arr=desc.split(".");arr.length>1;){if(/^\d+$/.test(arr[0])&&(arr[0]=parseInt(arr[0])),void 0===(obj=obj[arr[0]]))return;arr.shift()}return obj[arr[0]]}function subPropSet(obj,desc,val){for(var arr=desc.split(".");arr.length>1;)void 0===obj[arr[0]]&&(obj[arr[0]]={}),obj=obj[arr.shift()];obj[arr[0]]=val}function touchDown(event){event.preventDefault();var rect=act.canvas.getBoundingClientRect();act.position={x:(event.changedTouches[0].clientX-rect.left)/act.canvas.scale,y:(event.changedTouches[0].clientY-rect.top)/act.canvas.scale},act.prevPosition={x:act.position.x,y:act.position.y},mouseDown()}function touchMove(event){var rect=act.canvas.getBoundingClientRect();event.preventDefault(),act.position={x:(event.changedTouches[0].clientX-rect.left)/act.canvas.scale,y:(event.changedTouches[0].clientY-rect.top)/act.canvas.scale}}function touchUp(event){event.preventDefault();act.canvas.getBoundingClientRect();mouseUp()}this.version="1.4.2";var act={actionList:[],dragging:null,external:!1,imageList:{},loop:!0,mode:"none",mouseDown:!1,mouseDownCnt:0,pathList:{},paused:!1,position:{x:0,y:0},player:[],prevPosition:{x:0,y:0},soundList:{},touch:[],videoList:{}},ease=new function(t,b,c,d){this.linear=function(t,b,c,d){return c*t/d+b},this.inExp=function(t,b,c,d){return c*Math.pow(2,10*(t/d-1))+b},this.outExp=function(t,b,c,d){return c*(1-Math.pow(2,-10*t/d))+b},this.inOutExp=function(t,b,c,d){return(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:(t--,c/2*(2-Math.pow(2,-10*t))+b)},this.inQuad=function(t,b,c,d){return t/=d,c*t*t+b},this.outQuad=function(t,b,c,d){return t/=d,-c*t*(t-2)+b},this.inOutQuad=function(t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:(t--,-c/2*(t*(t-2)-1)+b)}};this.act=act;var pManager={pSystemList:[],create:function(obj){var pExist=pManager.pSystemList.filter(function(parTest){return parTest.id===obj.id})[0];if(void 0===pExist){var newPSystem={pList:[],time:{start:Date.now(),now:Date.now(),prev:Date.now(),diff:0,total:0}};newPSystem.id=obj.id,newPSystem.info=copyObj(obj,{}),newPSystem.info.position=void 0,newPSystem.position={current:{x:obj.position.current.x,y:obj.position.current.y}},pManager.pSystemList.push(newPSystem)}else pExist.time={start:Date.now(),now:Date.now(),prev:Date.now(),diff:0,total:0},pExist.info=copyObj(obj,{}),pExist.position={current:{x:obj.position.current.x,y:obj.position.current.y}}},draw:function(id){var pSystem=pManager.pSystemList.filter(function(obj){return obj.id===id})[0];if(void 0!==pSystem&&void 0!==act.imageList[pSystem.info.image]){if(act.imageList[pSystem.info.image].deferred&&!act.imageList[pSystem.info.image].deferredStart){act.imageList[pSystem.info.image].deferredStart=!0;var imageLoad=act.data.images.filter(function(im){return im.id===pSystem.info.image})[0];void 0!==imageLoad&&loadImage(imageLoad,pSystem.info.image,!1)}if(void 0!==act.imageList[pSystem.info.image].imageData&&void 0!=act.imageList[pSystem.info.image]){var imgDim={x:act.imageList[pSystem.info.image].imageData.naturalWidth/2,y:act.imageList[pSystem.info.image].imageData.naturalHeight/2};pSystem.info.blend&&(act.context.globalCompositeOperation=pSystem.info.blend),pSystem.pList.forEach(function(p){pSystem.info.keepalive||p.life.current--,p.position={x:p.position.x+p.dirNorm.x*p.speed.position,y:p.position.y+p.dirNorm.y*p.speed.position};var scale=p.scale,lifeCnt=p.life.max-p.life.current,pcent=lifeCnt/p.life.max,alpha=1;100*pcent<pSystem.info.pParams.fade.in&&(alpha=lifeCnt/(p.life.max*(.01*pSystem.info.pParams.fade.in))),100*pcent>pSystem.info.pParams.fade.out&&(alpha=p.life.current/(p.life.max-p.life.max*(.01*pSystem.info.pParams.fade.out)));var pos={x:parseInt(p.position.x),y:parseInt(p.position.y)};p.rotation+=p.speed.rotation,act.context.save(),act.context.translate(pos.x,pos.y),act.context.globalAlpha=alpha,act.context.rotate(p.rotation),act.context.drawImage(act.imageList[pSystem.info.image].imageData,-imgDim.x*scale,-imgDim.y*scale,act.imageList[pSystem.info.image].imageData.naturalWidth*scale,act.imageList[pSystem.info.image].imageData.naturalHeight*scale),act.context.restore(),act.context.globalAlpha=1}),pSystem.pList=pSystem.pList.filter(function(p){return p.life.current>0}),act.context.globalCompositeOperation="source-over"}}},getSystem:function(id){return pManager.pSystemList.filter(function(item){return item.id===id})[0]},update:function(){pManager.pSystemList.forEach(function(pSystem,index,particleSystemList){if(findParent(pSystem.info),pSystem.time.now=Date.now(),pSystem.time.diff=pSystem.time.now-pSystem.time.prev,pSystem.time.total=pSystem.time.now-pSystem.time.start,pSystem.time.diff>1e3/pSystem.info.emitRate&&pSystem.info.emitCounter>pSystem.time.total){var spawnCount=1;"burst"===pSystem.info.genType&&(spawnCount=pSystem.info.emitRate),pSystem.time.prev=pSystem.time.now;for(var cnt=0;cnt<spawnCount;cnt++){var partPos={x:pSystem.position.current.x,y:pSystem.position.current.y};if(pSystem.info.emitterSize>1){var t=2*Math.PI*randInterval(0,1),u=randInterval(0,1)+randInterval(0,1),r=u>1?2-u:u;partPos={x:(r*=pSystem.info.emitterSize)*Math.cos(t)+partPos.x,y:r*Math.sin(t)+partPos.y}}isNaN(pSystem.info.emitDirStart)&&(pSystem.info.emitDirStart=0),isNaN(pSystem.info.emitDirEnd)&&(pSystem.info.emitDirEnd=0);var rot=0,dir=radians(randInterval(pSystem.info.emitDirStart-90,pSystem.info.emitDirEnd-90));pSystem.info.faceMotion&&(rot=dir,pSystem.info.faceAngle&&(rot+=radians(pSystem.info.faceAngle)));var rndDir={x:Math.cos(dir),y:Math.sin(dir)},scale=randInterval(pSystem.info.pParams.scale.min,pSystem.info.pParams.scale.max),rndLife=randIntervalInt(pSystem.info.pParams.life.min,pSystem.info.pParams.life.max),speed={position:randInterval(pSystem.info.pParams.speed.position.min,pSystem.info.pParams.speed.position.max),rotation:randInterval(pSystem.info.pParams.speed.rotation.min,pSystem.info.pParams.speed.rotation.max)},unit=getUnit(rndDir),parentTransform={position:{x:0,y:0},scale:1,rotation:0};void 0!==pSystem.info.parent&&void 0!==pSystem.info.parent.object&&(parentTransform.position={x:pSystem.info.parent.object.position.current.x,y:pSystem.info.parent.object.position.current.y}),partPos={x:partPos.x+parentTransform.position.x,y:partPos.y+parentTransform.position.y},pSystem.pList.push({position:partPos,rotation:rot,dirNorm:unit,scale:scale,speed:speed,life:{max:rndLife,current:rndLife}})}}pSystem.time.total>pSystem.info.emitCounter&&!pSystem.info.keepalive&&0===pSystem.pList.length&&particleSystemList.splice(index,1)})}};document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?act.paused=!0:act.paused=!1},!1),"file"==dataForm?function(fileNamePath,returnFunction){var fileToDl=fileNamePath;fileToDl+="?"+(new Date).getTime();var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){4==xhr.readyState&&returnFunction(JSON.parse(xhr.responseText)),404==xhr.status&&console.error("JSON Load Error: "+xhr.statusText+" "+xhr.readyState)},xhr.overrideMimeType("application/json"),xhr.open("GET",fileToDl,!0),xhr.send(null)}(interactiveData,init):init("string"==dataForm?JSON.parse(interactiveData):interactiveData),this.external=function(cList){act.external=!0,cList.forEach(function(cmd){"selectonly"===cmd.command&&(act.mode="click",void 0!==getObjById(cmd.item)&&act.actionList.push({mode:"click",obj:getObjById(cmd.item)}))})},this.report=function(wat){console.log(act[wat])},this.export=function(){return act.data}}