function initCanvasser(t,e,i,a){void 0==a&&(a=[]),window[t]&&(window[t].act.loop=!1);var o=window[t]?{x:window[t].act.position.x,y:window[t].act.position.y}:{x:-1,y:-1};return window[t]=new canvasser(t,e,i,a),window[t].act.position={x:o.x,y:o.y},window[t]}function canvasser(t,e,i,a){function o(e){a.forEach(function(t){P(e,Object.keys(t)[0],Object.values(t)[0])}),void 0===e.layers&&(e.layers=[{list:[],show:!0}],["objects","particles"].forEach(function(t){void 0!==e[t]&&e[t].forEach(function(i){e.layers[0].list.push({id:i.id,type:t,name:i.name})})})),O.canvas=document.createElement("canvas"),O.context=O.canvas.getContext("2d"),O.canvas.width=e.settings.canvaswidth,O.canvas.height=e.settings.canvasheight,O.data=e,document.getElementById(e.settings.canvasparent).innerHTML="",document.getElementById(e.settings.canvasparent).appendChild(O.canvas),O.canvas.addEventListener("mousemove",h,!1),O.canvas.addEventListener("mousedown",E,!1),O.canvas.addEventListener("mouseup",j,!1),O.canvas.addEventListener("mouseleave",S,!1),O.canvas.addEventListener("onmouseenter",D,!1),O.canvas.addEventListener("touchstart",k,!1),O.canvas.addEventListener("touchmove",A,!1),O.canvas.addEventListener("touchend",I,!1),O.data.paths&&O.data.paths.forEach(function(t){O.pathList[t.id]=t.url}),O.data.sounds&&O.data.sounds.forEach(function(t){void 0!=t.path&&(t.url=O.pathList[t.path]+"/"+t.url),O.soundList[t.id]=new Audio(t.url)}),void 0===O.data.tests&&(O.data.tests=[]),O.data.images.forEach(function(t){if(t.deferred)O.imageList[t.id]={deferred:!0};else if(t.local){var e=document.createElement("img");e.src=t.data,imageObj.src="data:image;base64,"+btoa(t.data),O.imageList[t.id]={},O.imageList[t.id].imageData=e,O.imageList[t.id].canvas=document.createElement("canvas"),O.imageList[t.id].canvas.width=e.width,O.imageList[t.id].canvas.height=e.height,O.imageList[t.id].context=O.imageList[t.id].canvas.getContext("2d"),O.imageList[t.id].context.drawImage(e,0,0,imageObj.src.width,imageObj.src.height),t.atlas&&(O.imageList[t.id].atlas={},O.imageList[t.id].atlas.cellwidth=t.cellwidth,O.imageList[t.id].atlas.cellheight=t.cellheight,O.imageList[t.id].atlas.numX=Math.floor(imageObj.src.width/t.cellwidth),O.imageList[t.id].atlas.numY=Math.floor(imageObj.src.height/t.cellheight))}else c(t,null,!1)}),void 0!==O.data.anims&&O.data.anims.forEach(function(t){t.autostart&&O.player.push(p(t,{}))}),void 0===O.data.constraints&&(O.data.constraints=[]);var i=Array.from(document.querySelectorAll('[data-canvasser="'+t+'"]'));i.length>0&&i.forEach(function(e){e.addEventListener("click",function(){window[t].external(JSON.parse(e.getAttribute("data-canvasser-command")))})}),r()}function n(t){var e=!0;void 0!==t.testlist&&(t.testlist.forEach(function(t){if("position"===t.type){var i=O.data.objects.filter(function(e){return e.id===t.itemtocheck})[0],a=O.data.objects.filter(function(e){return e.id===t.position})[0];if(void 0===O.imageList[i.image])return void(e=!1);var o={x:i.position.current.x,y:i.position.current.y};if("center"===i.origin){var n={x:i.position.current.x,y:i.position.current.y};o={x:Math.floor(n.x-O.imageList[i.image].imageData.naturalWidth/2*i.scale.current),y:Math.floor(n.y-O.imageList[i.image].imageData.naturalHeight/2*i.scale.current)}}0===w({id:i.image,pos:{x:a.position.current.x-o.x,y:a.position.current.y-o.y}})[3]&&(e=!1)}if("var"===t.type){var r=O.data.vars.filter(function(e){return e.id===t.itemtocheck})[0];if(void 0!==r){var s=!1;"equal"===t.comparetype&&r.value===t.value&&(s=!0),"greater"===t.comparetype&&r.value>t.value&&(s=!0),"less"===t.comparetype&&r.value<t.value&&(s=!0),s||(e=!1)}}}),e&&(t.trueoff&&(t.active=!1),O.actionList.push({mode:"true",obj:{truelist:t.truelist}})))}function r(){function t(t){if(void 0!==t){if(v(t),"shape"===t.type&&t.show){var e=void 0!=t.parent?t.parent.object:void 0,i=O.data.shapes.filter(function(e){return e.id===t.shape})[0];O.context.save(),t.blend&&(O.context.globalCompositeOperation=t.blend);var a=s(O,e,t.position.current,i,t.color,t.testp,O.position,t.scale.current,t.usecolor);if(O.context.restore(),!t.testp)return;a&&"none"!==O.mode&&O.actionList.push({mode:O.mode,obj:t})}if("image"===t.type&&t.show){if(void 0===O.imageList[t.image])return;if(O.imageList[t.image].deferred&&!O.imageList[t.image].deferredStart){O.imageList[t.image].deferredStart=!0;var o=O.data.images.filter(function(e){return e.id===t.image})[0];void 0!==o&&c(o,t.image,!1)}if(void 0===O.imageList[t.image].imageData)return;t.parentTransform={position:{x:0,y:0},scale:1,rotation:0},void 0!==t.parent&&void 0!==t.parent.object&&(t.parentTransform={position:{x:t.parent.object.position.current.x,y:t.parent.object.position.current.y},scale:t.parent.object.scale.current,rotation:t.parent.object.rotation});var n={x:t.position.current.x*t.parentTransform.scale+t.parentTransform.position.x,y:t.position.current.y*t.parentTransform.scale+t.parentTransform.position.y},r=O.imageList[t.image].atlas;(0===t.scale.current||NaN===t.scale.current||t.scale.current<0)&&(t.scale.current=.01),void 0===t.originxy&&(t.originxy={current:{x:0,y:0}});var d={x:t.originxy.current.x,y:t.originxy.current.y};if(d="center"===t.origin?r?{x:-Math.floor(r.cellwidth/2*t.scale.current),y:-Math.floor(r.cellheight/2*t.scale.current)}:{x:-Math.floor(O.imageList[t.image].imageData.naturalWidth/2*t.scale.current*t.parentTransform.scale),y:-Math.floor(O.imageList[t.image].imageData.naturalHeight/2*t.scale.current*t.parentTransform.scale)}:{x:-Math.floor(t.originxy.current.x*t.scale.current),y:-Math.floor(t.originxy.current.y*t.scale.current)},isNaN(n.x)&&(console.log("x NaN"),n.x=0),isNaN(n.y)&&(console.log("y NaN"),n.y=0),t.show){if(void 0===t.opacity&&(t.opacity={current:1}),O.context.save(),O.context.globalAlpha=t.opacity.current,t.blend&&(O.context.globalCompositeOperation=t.blend),O.context.translate(n.x,n.y),O.context.rotate(t.rotation),O.context.translate(d.x,d.y),O.context.scale(t.scale.current*t.parentTransform.scale,t.scale.current*t.parentTransform.scale),r?(void 0===t.atlascell&&(t.atlascell={x:0,y:0}),O.context.drawImage(O.imageList[t.image].imageData,r.cellwidth*t.atlascell.x,r.cellheight*t.atlascell.y,r.cellwidth,r.cellheight,0,0,r.cellwidth,r.cellheight,r.cellwidth,r.cellheight)):O.context.drawImage(O.imageList[t.image].imageData,0,0,O.imageList[t.image].imageData.naturalWidth,O.imageList[t.image].imageData.naturalHeight),O.context.restore(),!t.testp||"none"===O.mode)return;var l=[0,0,0,0];t.scale.current>.001&&("center"===t.origin&&(t.originxy.current.x=-Math.floor(O.imageList[t.image].imageData.naturalWidth/2),t.originxy.current.y=-Math.floor(O.imageList[t.image].imageData.naturalHeight/2)),l=w({id:t.image,pos:{x:Math.floor((O.position.x-n.x-t.originxy.current.x)/t.scale.current),y:Math.floor((O.position.y-n.y-t.originxy.current.y)/t.scale.current)}})),0!=l[3]&&"none"!==O.mode?O.actionList.push({mode:O.mode,obj:t}):null!==O.dragging&&t.id===O.dragging.id&&O.actionList.push({mode:O.mode,obj:t})}}}}O.data.tests.forEach(function(t){t.active&&n(t)}),O.canvas.scale=O.canvas.scrollWidth/O.canvas.width,O.data.constraints.forEach(function(t){t.active&&t.driverlist.forEach(function(t){if("position"===t.type){if(void 0===t.driver||void 0===t.constrained||void 0===t.axis||void 0===t.operation||void 0===t.value)return;var e=O.data.objects.filter(function(e){return e.id===t.driver})[0],i=O.data.objects.filter(function(e){return e.id===t.constrained})[0];if(void 0===e||void 0===i)return;void 0===t.offset&&(t.offset={x:0,y:0}),void 0===t.offset.x&&(t.offset.x=0),void 0===t.offset.y&&(t.offset.y=0);var a={x:d(t.operation,e.position.current.x,t.value),y:d(t.operation,e.position.current.y,t.value)};"x"!==t.axis&&"xy"!==t.axis||(i.position.current.x=a.x+t.offset.x),"y"!==t.axis&&"xy"!==t.axis||(i.position.current.y=a.y+t.offset.y)}if("lookat"===t.type){var e=O.data.objects.filter(function(e){return e.id===t.driver})[0],i=O.data.objects.filter(function(e){return e.id===t.constrained})[0];if(void 0===e||void 0===i)return;var o={x:e.position.current.x-i.position.current.x,y:e.position.current.y-i.position.current.y},n=Math.sqrt(o.x*o.x+o.y*o.y),r={x:o.x/n,y:o.y/n};void 0===t.angle&&(t.angle=0),void 0===i.rotation&&(i.rotation=0),i.rotation=3.1415926536-Math.atan2(r.x,r.y)+N(t.angle)}if("relation"===t.type){var e=O.data.objects.filter(function(e){return e.id===t.driver})[0],i=O.data.objects.filter(function(e){return e.id===t.constrained})[0];if(void 0===e||void 0===i)return;var s=0;s=C(e,t.driverop),t.useminmax&&(s=(s-t.drivermin)/(t.drivermax-t.drivermin)*(t.constrainmax-t.constrainmin)+t.constrainmin),P(i,t.constrainop,s)}})}),O.player.forEach(function(t){if(void 0===t.playing&&(t.playing=[]),void 0===t.nowStamp&&(t.reverse?t.nowStamp=Date.now()+30:t.nowStamp=Date.now()-30),void 0===t.timeActual&&(t.timeActual=1),void 0===t.time&&(t.time=1),void 0===t.speed&&(t.speed=1),t.prevStamp=t.nowStamp,t.prevTime=t.time,t.nowStamp=Date.now(),!t.pause){t.nowStamp-t.prevStamp<2e3&&(t.timeActual+=t.nowStamp-t.prevStamp,t.reverse?t.time=(t.length-t.timeActual)*t.speed:t.time=t.timeActual*t.speed);var e=!1;if(!t.reverse&&t.time>=t.length&&(e=!0),t.reverse&&t.time<=0&&(e=!0),e&&(t.delete=!0,t.loop)){var i=O.data.anims.filter(function(e){return e.id===t.id})[0];O.player.push(p(i,{}))}void 0!=t.timelist&&t.timelist.forEach(function(e){(e.starttime<1||void 0===e.starttime)&&(e.starttime=1);var i=!1;if(!t.reverse&&e.starttime>=t.prevTime&&e.starttime<=t.time&&(i=!0),t.reverse&&e.endtime>=t.time&&e.endtime<=t.prevTime&&(i=!0),i){var a=p(e,{});t.playing.push(a)}}),t.playing.forEach(function(e){if("flipbook"===e.type){var i=O.data.objects.filter(function(t){return t.id===e.id})[0];void 0===e.atlascell&&(e.atlascell={x:0,y:0}),void 0===e.atlascell.x&&(e.atlascell.x=0),void 0===e.atlascell.y&&(e.atlascell.y=0),i&&(i.atlascell={x:e.atlascell.x,y:e.atlascell.y}),e.delete=!0}if("layerassign"===e.type){var a=-1;O.data.layers.forEach(function(t,i){t.id===e.tolayer&&(a=i)});var o=!1;O.data.layers.forEach(function(t,i){t.list.forEach(function(t,n){if(!o&&t.id===e.id){o=!0;var r=O.data.layers[i].list.splice(n,1)[0];"bottom"===e.layerpos&&O.data.layers[a].list.splice(n,0,r),"top"===e.layerpos&&O.data.layers[a].list.push(r)}})}),e.delete=!0}if("loadinto"===e.type&&(O.loop=!1,initCanvasser(e.vari,e.url,"file")),"play"===e.type){var n=O.data.anims.filter(function(t){return t.id===e.id})[0];O.player.push(p(n,{})),e.delete=!0}if("pstart"===e.type&&(O.data.particles.forEach(function(t){void 0!==t.id&&t.id===e.id&&W.create(t)}),e.delete=!0),"sound"===e.type&&(void 0!=e.id&&O.soundList[e.id].play(),e.delete=!0),"soundstop"===e.type&&(void 0!=e.id&&(O.soundList[e.id].pause(),O.soundList[e.id].currentTime=0),e.delete=!0),"testpset"===e.type&&("group"===e.filter?(r=m(e.id)).forEach(function(t){t.testp=e.testp}):(i=O.data.objects.filter(function(t){return t.id===e.id})[0]).testp=e.testp,e.delete=!0),"vis"===e.type&&("group"===e.filter?(r=m(e.id)).forEach(function(t){t.show=e.show}):(i=O.data.objects.filter(function(t){return t.id===e.id})[0]).show=e.show,e.delete=!0),void 0!==e.endtime&&e.endtime<t.time){if(void 0===(i=y(e)))return;if("fade"===e.type&&("group"===e.filter?(r=m(e.id)).forEach(function(t){void 0===t.opacity&&(t.opacity={current:0}),t.opacity.current=e.endalpha}):void 0!=(i=O.data.objects.filter(function(t){return t.id===e.id})[0])&&(void 0===i.opacity&&(i.opacity={current:0}),void 0===e.endalpha&&(e.endalpha=0),i.opacity.current=e.endalpha)),"move"===e.type&&void 0!=e.endpos)if("group"===e.filter){var r=m(i.id);r.forEach(function(t){t.position.current={x:e.endpos.x,y:e.endpos.y}})}else i.position.current={x:e.endpos.x,y:e.endpos.y};"turn"===e.type&&(i.rotation=N(e.endrot),e.fromCurrentStart=void 0),e.delete=!0}}),t.playing=t.playing.filter(function(t){return!t.delete}),t.playing.forEach(function(e){var i=y(e);if(void 0!==i){if("fade"===e.type)if(void 0===e.startalpha&&(e.startalpha=0),void 0===e.endalpha&&(e.endalpha=0),"group"===e.filter)(c=m(e.id)).forEach(function(i){void 0===i.opacity&&(i.opacity={current:0}),e.fromcurrent&&(e.startalpha=i.opacity.current);var a=(t.time-e.starttime)/(e.endtime-e.starttime),o=(e.endalpha-e.startalpha)*a+e.startalpha;i.opacity.current=o});else{void 0===(i=O.data.objects.filter(function(t){return t.id===e.id})[0]).opacity&&(i.opacity={current:0}),e.fromcurrent&&(e.startalpha=i.opacity.current);var a=(t.time-e.starttime)/(e.endtime-e.starttime),o=(e.endalpha-e.startalpha)*a+e.startalpha;void 0!=i&&(void 0===i.opacity&&(i.opacity={current:0}),void 0===e.endalpha&&(e.endalpha=0),i.opacity.current=o)}if("move"===e.type){e.fromcurrent&&(e.startpos={x:i.position.current.x,y:i.position.current.y}),void 0===e.startpos&&(e.startpos={x:0,y:0}),void 0===e.endpos&&(e.endpos={x:0,y:0}),isNaN(e.startpos.x)&&(e.startpos.x=0),isNaN(e.startpos.y)&&(e.startpos.y=0),isNaN(e.endpos.x)&&(e.endpos.x=0),isNaN(e.endpos.y)&&(e.endpos.y=0);var a=(t.time-e.starttime)/(e.endtime-e.starttime),n=t.time-e.starttime,r=e.endtime-e.starttime;void 0===e.ease&&(e.ease="linear");var s={x:H[e.ease](n,e.startpos.x,e.endpos.x-e.startpos.x,r),y:H[e.ease](n,e.startpos.y,e.endpos.y-e.startpos.y,r)};isNaN(s.x)&&console.log("posDiff x NaN"),isNaN(s.y)&&console.log("posDiff y NaN"),"group"===e.filter?(c=m(i.id)).forEach(function(t){t.position.current={x:Math.round(s.x),y:Math.round(s.y)}}):i.position.current={x:Math.round(s.x),y:Math.round(s.y)}}if("scale"===e.type)if("group"===e.filter){var c=m(i.id);c.forEach(function(i){(void 0===e.startscale||e.fromcurrent)&&(e.startscale=i.scale.current);var a=(t.time-e.starttime)/(e.endtime-e.starttime),o=(e.endscale-e.startscale)*a+e.startscale;i.scale.current=o})}else{(void 0===e.startscale||e.fromcurrent)&&(e.startscale=i.scale.current);var a=(t.time-e.starttime)/(e.endtime-e.starttime),d=(e.endscale-e.startscale)*a+e.startscale;i.scale.current=d}if("turn"===e.type){void 0===i.rotation&&(i.rotation=0);var l=0,u=N(e.endrot);e.fromcurrent?void 0==e.fromCurrentStart?(l=i.rotation,e.fromCurrentStart=l):l=e.fromCurrentStart:void 0!==e.startrot&&(l=N(e.startrot));var f=(u-l)*(a=(t.time-e.starttime)/(e.endtime-e.starttime))+l;i.rotation=f}}})}}),O.player=O.player.filter(function(t){return!t.delete}),"true"===O.mode&&(O.mode="none"),O.mouseDown?(O.mouseDownCnt++,O.position.x!==O.prevPosition.x&&O.position.y!==O.prevPosition.y&&O.mouseDownCnt>2&&(O.mode="drag",O.canvas.style.cursor="move")):O.canvas.style.cursor="default",O.context.clearRect(0,0,O.canvas.width,O.canvas.height),W.update(),O.data.layers.forEach(function(e){e.show&&e.list.forEach(function(e){"particles"===e.type&&W.draw(e.id),"objects"===e.type&&t(O.data.objects.filter(function(t){return t.id===e.id})[0])})}),l(),O.prevPosition={x:O.position.x,y:O.position.y},"drop"===O.mode&&S(),O.loop&&window.requestAnimationFrame(r)}function s(t,e,i,a,o,n,r,s,c){if(void 0===o.current&&(o.current=["rgb(0,0,0,1)"]),void 0!==a){var d=t.context,l=!1,u=0,f={x:0,y:0,scale:1};void 0!==e&&(f={x:e.position.current.x,y:e.position.current.y,scale:e.scale.current});var p={x:parseInt(i.x*f.scale+f.x),y:parseInt(i.y*f.scale+f.y)},m=s*f.scale;return d.beginPath(),void 0===a.drawcode&&(a.drawcode=[]),a.drawcode.forEach(function(e){a={x:0,y:0};if(void 0!==e.offset&&(a={x:e.offset.x,y:e.offset.y}),"move"===e.type&&d.moveTo(p.x+a.x*m,p.y+a.y*m),"rect"===e.type&&d.rect(p.x+a.x*m,p.y+a.y*m,e.width*m,e.height*m),"arc"===e.type&&d.arc(p.x+a.x*m,p.y+a.y*m,e.radius*m,N(e.startangle),N(e.endangle),e.counterclockwise),"bcurve"===e.type&&d.bezierCurveTo(p.x+offseta.x*m,p.y+offseta.y*m,p.x+offsetb.x*m,p.y+offsetb.y*m,p.x+offsetc.x*m,p.y+offsetc.y*m),"line"===e.type&&d.lineTo(p.x+a.x*m,p.y+a.y*m),"linewidth"===e.type&&(d.lineWidth=e.width*m),"fillcolor"===e.type&&(d.fillStyle=e.color),"fill"===e.type&&(c&&(d.fillStyle=o.current[u]),d.fill()),"textfill"===e.type){void 0===p&&(p={x:0,y:0});a={x:0,y:0};void 0!=e.offset&&(void 0!==e.offset.x&&(a.x=e.offset.x),void 0!==e.offset.y&&(a.y=e.offset.y)),c?d.fillStyle=o.current[u]:void 0!==e.color&&(d.fillStyle=e.color);s=1;void 0!==e.size&&(s=e.size),e.font&&(d.font=s*m+"px "+e.font);var i=e.text.replace(/\{{(.+?)\}}/g,function(e,i,a,o,n,r){return t.data.vars.filter(function(t){return t.name===i})[0].value});d.fillText(i,p.x+a.x*m,p.y+a.y*m)}if("textline"===e.type){void 0===p&&(p={x:0,y:0});var a={x:0,y:0};void 0!=e.offset&&(void 0!==e.offset.x&&(a.x=e.offset.x),void 0!==e.offset.y&&(a.y=e.offset.y)),d.lineWidth=e.width,c?d.strokeStyle=o.current[u]:void 0!==e.color&&(d.strokeStyle=e.color);var s=1;void 0!==e.size&&(s=e.size),e.font&&(d.font=s*m+"px "+e.font),d.strokeText(e.text,p.x+a.x*m,p.y+a.y*m)}"outlinetext"===e.type&&(d.lineWidth=e.stroke,d.strokeStyle=o.current[u],d.strokeText(e.text,p.x+a.x*m,p.y+a.y*m),u++,d.fillStyle=o.current[u],d.fillText(e.text,p.x+a.x*m,p.y+a.y*m)),"textfont"===e.type&&(d.font=e.size*m+"px "+e.font),"strokecolor"===e.type&&(d.strokeStyle=e.color),"stroke"===e.type&&d.stroke(),"ptest"===e.type&&n&&d.isPointInPath(r.x,r.y)&&(l=!0),"close"===e.type&&d.closePath(),"begin"===e.type&&(d.beginPath(),u++)}),d.closePath(),l}}function c(t,e,i){var a=!O.data.settings.usecache;i&&(a=!0);var o=new Image;o.setAttribute("crossOrigin","anonymous"),o.src=(void 0!=t.path?O.pathList[t.path]+"/"+t.url:t.url)+(a?"?"+(new Date).getTime():""),o.onload=function(){O.imageList[t.id]={},O.imageList[t.id].imageData=this,O.imageList[t.id].canvas=document.createElement("canvas"),O.imageList[t.id].canvas.width=this.width,O.imageList[t.id].canvas.height=this.height,O.imageList[t.id].context=O.imageList[t.id].canvas.getContext("2d"),O.imageList[t.id].context.drawImage(this,0,0,this.width,this.height),t.atlas&&(O.imageList[t.id].atlas={},O.imageList[t.id].atlas.cellwidth=t.cellwidth,O.imageList[t.id].atlas.cellheight=t.cellheight,O.imageList[t.id].atlas.numX=Math.floor(this.width/t.cellwidth),O.imageList[t.id].atlas.numY=Math.floor(this.height/t.cellheight));try{O.imageList[t.id].context.getImageData(0,0,1,1).data}catch(e){O.imageList[t.id].tainted=!0}null!==e&&(delete O.imageList[e].deferred,delete O.imageList[e].deferredStart)}}function d(t,e,i){return"add"===t?e+i:"subtract"===t?e-i:"multiply"===t?e*i:"divide"===t?e/i:void 0}function l(){O.actionList.forEach(function(t){void 0!==t.obj[t.mode+"list"]&&t.obj[t.mode+"list"].forEach(function(e){if("cleardown"===e.type&&(O.mode="none"),"console"===e.type&&console.log(e.text),"conditional"===e.type){if("position"===e.check){var i=O.data.objects.filter(function(t){return t.id===e.itemtocheck})[0],a=O.data.objects.filter(function(t){return t.id===e.position})[0],o={x:i.position.current.x,y:i.position.current.y};if("center"===i.origin){var n={x:i.position.current.x,y:i.position.current.y};o={x:Math.floor(n.x-O.imageList[i.image].imageData.naturalWidth/2*i.scale.current),y:Math.floor(n.y-O.imageList[i.image].imageData.naturalHeight/2*i.scale.current)}}0!=w({id:i.image,pos:{x:a.position.current.x-o.x,y:a.position.current.y-o.y}})[3]?O.actionList.push({mode:"true",obj:a,next:!0}):O.actionList.push({mode:"false",obj:a,next:!0})}if("var"===e.check){var r=O.data.vars.filter(function(t){return t.id===e.itemtocheck})[0];if(void 0!==r){var s=!1;"equal"===e.comparetype&&r.value===e.value&&(s=!0),"greater"===e.comparetype&&r.value>e.value&&(s=!0),"less"===e.comparetype&&r.value<e.value&&(s=!0),s?O.actionList.push({mode:"true",obj:t,next:!0}):O.actionList.push({mode:"false",obj:t,next:!0})}}}if("copyelement"===e.type){var c=document.getElementById(e.target),d=document.getElementById(e.source);void 0!==c&&void 0!==d&&null!==c&&null!==d&&(c.innerHTML=d.innerHTML)}if("execute"===e.type&&window[e.function](e.params),"function"===e.type&&window[e.function]({id:e.id}),"increment"===e.type&&O.data.objects.forEach(function(t){if(f(e,t)){var i=Number(C(t,e.prop))+Number(e.newvalue);e.rangemin&&i<Number(e.rangemin)||e.rangemax&&i>Number(e.rangemax)||P(t,e.prop,i.toString())}}),"loadinto"===e.type&&(O.loop=!1,initCanvasser(e.vari,e.url,"file")),"loadpage"===e.type&&(e.newpage?window.open(e.url,"_blank"):window.location.href=e.url),"pauseanim"===e.type){var l=O.player.filter(function(t){return t.id===e.animation})[0];void 0===l.pause&&(l.pause=!1),e.toggle?l.pause=!l.pause:l.pause=!0}if("playanim"===e.type){var u=O.data.anims.filter(function(t){return t.id===e.animation})[0];O.player.push(p(u,{}))}if("modvar"===e.type){var v=O.data.vars.filter(function(t){return t.id===e.id})[0];"add"===e.operation&&(v.value=Number(v.value)+Number(e.amount)),"sub"===e.operation&&(v.value=Number(v.value)-Number(e.amount)),"set"===e.operation&&(v.value=Number(e.amount))}if("swapimage"===e.type&&O.data.objects.forEach(function(t){void 0!==t.id&&t.id===e.id&&(t.image=e.image)}),"moveobject"===e.type&&O.data.objects.forEach(function(t){void 0!==t.id&&t.id===e.id&&("absolute"===e.frame&&(t.position.current={x:e.amount.x,y:e.amount.y}),"relative"===e.frame&&(t.position.current.x+=e.amount.x,t.position.current.y+=e.amount.y))}),"pstart"===e.type&&O.data.particles.forEach(function(t){void 0!==t.id&&t.id===e.id&&W.create(t)}),"scale"===e.type&&O.data.objects.forEach(function(t){f(e,t)&&("increment"===e.frame&&(t.scale.current+=e.amount),"multiply"===e.frame&&(t.scale.current=t.scale.current*e.amount),"absolute"===e.frame&&(t.scale.current=e.amount))}),"set"===e.type&&O.data.objects.forEach(function(t){f(e,t)&&P(t,e.prop,e.newvalue.toString())}),"shapecolor"===e.type&&O.data.objects.forEach(function(t){f(e,t)&&("default"===e.source&&(t.color=t.defaultcolor),"hover"===e.source&&(t.color=t.hovercolor),"selectcolor"===e.source&&(t.color=t.selectcolor),"value"===e.source&&(t.color=e.color))}),"slideobject"===e.type){y="object";void 0!==e.filter&&(y=e.filter),O.data.objects.forEach(function(t){if(void 0!==e.id){if("group"!==y){if(void 0===t.id)return;if(null!==O.dragging&&t.id!==O.dragging.id)return;if(t.id!==e.id)return;O.dragging=t}if("group"!==y||void 0!==t.groups.find(function(t){return t.id===e.id})){if(void 0!==t.parent?(void 0===t.position.offset&&(t.position.offset={x:t.position.current.x,y:t.position.current.y}),e.constrainx||(t.position.current.x+=O.position.x-O.prevPosition.x),e.constrainy||(t.position.current.y+=O.position.y-O.prevPosition.y)):(e.constrainx||(t.position.current.x+=O.position.x-O.prevPosition.x),e.constrainy||(t.position.current.y+=O.position.y-O.prevPosition.y)),e.limitx&&(t.position.current.x<e.minx&&(t.position.current.x=e.minx),t.position.current.x>e.maxx&&(t.position.current.x=e.maxx),e.usebounds&&"image"===t.type)){var i=O.imageList[t.image].canvas.width*t.scale.current;t.position.current.x+i>e.maxx&&(t.position.current.x=e.maxx-i)}if(e.limity&&(t.position.current.y<e.miny&&(t.position.current.y=e.miny),t.position.current.y>e.maxy&&(t.position.current.y=e.maxy),e.usebounds&&"image"===t.type)){var a=O.imageList[t.image].canvas.height*t.scale.current;t.position.current.y+a>e.maxy&&(t.position.current.y=e.maxy-a)}}}})}if("slideover"===e.type&&console.log("slideOver"),"sound"===e.type&&O.soundList[e.id].play(),"testpset"===e.type){var y="object";void 0!==e.filter&&(y=e.filter),"group"===y?m(e.id).forEach(function(t){t.testp=e.testp}):O.data.objects.filter(function(t){return t.id===e.id})[0].testp=e.testp}"url"===e.type&&void 0!=(c=document.getElementById(e.target))&&b(e.url,c),"vis"===e.type&&O.data.objects.forEach(function(t){f(e,t)&&(t.show=e.show)})})}),O.actionList=O.actionList.filter(function(t){return t.next}),O.actionList.forEach(function(t){delete t.next})}function u(t){var e=[];return t.forEach(function(t){"object"==typeof t?Array.isArray(t)?e.push(u(t)):e.push(p(t,{})):e.push(t)}),e}function f(t,e){if(void 0===t.filter)return!1;if("group"===t.filter){if(void 0===e.groups)return!1;if(void 0===e.groups.find(function(e){return e.id===t.id}))return!1}return"object"!==t.filter||e.id===t.id}function p(t,e){for(var i in t)t.hasOwnProperty(i)&&("object"==typeof t[i]?Array.isArray(t[i])?e[i]=u(t[i]):e[i]=p(t[i],{}):e[i]=t[i]);return e}function m(t){return O.data.objects.filter(function(e){if(void 0!==e.groups){var i=!1;return e.groups.forEach(function(e){e.id===t&&(i=!0)}),!!i||void 0}})}function v(t){if(void 0!==t.parent&&void 0===t.parent.object){var e=O.data.objects.filter(function(e){return e.id===t.parent.id})[0];void 0!==e&&(t.parent.object=e)}}function y(t){void 0===t.filter&&(t.filter="object");var e="objects";void 0!=t.filter&&(e=t.filter+"s");var i=O.data[t.filter+"s"].filter(function(e){return e.id===t.id})[0];return"particles"===e&&(i=W.getSystem(t.id)),i}function g(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function h(t){var e=O.canvas.getBoundingClientRect();O.position={x:(t.clientX-e.left)/O.canvas.scale,y:(t.clientY-e.top)/O.canvas.scale}}function x(t){return O.data.objects.filter(function(e){return e.id===t})[0]}function w(t){return O.imageList[t.id].tainted?(c(O.data.images.filter(function(e){return e.id===t.id})[0],null,!0),[0,0,0,0]):O.imageList[t.id].context.getImageData(t.pos.x,t.pos.y,1,1).data}function L(t){var e=g(t);return{x:t.x/e,y:t.y/e}}function b(t,e){var i=t;!1===O.data.settings.usecache&&(i+="?"+(new Date).getTime());var a=new XMLHttpRequest;a.addEventListener("load",function(){e.innerHTML=this.responseText}),a.open("GET",i),a.send()}function E(){O.mode="click",O.external=!1,O.mouseDown=!0,O.mouseDownCnt=0}function j(){O.mode="none",O.mouseDown=!1,O.mouseDownCnt=0,null!==O.dragging&&(O.mode="drop",O.dragging=null)}function D(){O.mode="none",O.mouseDown=!1,O.mouseDownCnt=0}function S(){O.mode="none",O.mouseDown=!1,O.mouseDownCnt=0,O.dragging=null}function N(t){return.01745329251994*t}function M(t,e){return Math.random()*(e-t)+t}function T(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function C(t,e){for(var i=e.split(".");i.length>1;){if(/^\d+$/.test(i[0])&&(i[0]=parseInt(i[0])),void 0===(t=t[i[0]]))return;i.shift()}return t[i[0]]}function P(t,e,i){for(var a=e.split(".");a.length>1;)void 0===t[a[0]]&&(t[a[0]]={}),t=t[a.shift()];t[a[0]]=i}function k(t){t.preventDefault();var e=O.canvas.getBoundingClientRect();O.position={x:(t.changedTouches[0].clientX-e.left)/O.canvas.scale,y:(t.changedTouches[0].clientY-e.top)/O.canvas.scale},O.prevPosition={x:O.position.x,y:O.position.y},E()}function A(t){var e=O.canvas.getBoundingClientRect();t.preventDefault(),O.position={x:(t.changedTouches[0].clientX-e.left)/O.canvas.scale,y:(t.changedTouches[0].clientY-e.top)/O.canvas.scale}}function I(t){t.preventDefault();O.canvas.getBoundingClientRect();j()}this.version="1.4.0";var O={actionList:[],dragging:null,external:!1,imageList:{},loop:!0,mode:"none",mouseDown:!1,mouseDownCnt:0,pathList:{},paused:!1,position:{x:0,y:0},player:[],prevPosition:{x:0,y:0},soundList:{},touch:[]},H=new function(t,e,i,a){this.linear=function(t,e,i,a){return i*t/a+e},this.inExp=function(t,e,i,a){return i*Math.pow(2,10*(t/a-1))+e},this.outExp=function(t,e,i,a){return i*(1-Math.pow(2,-10*t/a))+e},this.inOutExp=function(t,e,i,a){return(t/=a/2)<1?i/2*Math.pow(2,10*(t-1))+e:(t--,i/2*(2-Math.pow(2,-10*t))+e)},this.inQuad=function(t,e,i,a){return t/=a,i*t*t+e},this.outQuad=function(t,e,i,a){return t/=a,-i*t*(t-2)+e},this.inOutQuad=function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)}};this.act=O;var W={pSystemList:[],create:function(t){var e=W.pSystemList.filter(function(e){return e.id===t.id})[0];if(void 0===e){var i={pList:[],time:{start:Date.now(),now:Date.now(),prev:Date.now(),diff:0,total:0}};i.id=t.id,i.info=p(t,{}),i.info.position=void 0,i.position={current:{x:t.position.current.x,y:t.position.current.y}},W.pSystemList.push(i)}else e.time={start:Date.now(),now:Date.now(),prev:Date.now(),diff:0,total:0},e.info=p(t,{}),e.position={current:{x:t.position.current.x,y:t.position.current.y}}},draw:function(t){var e=W.pSystemList.filter(function(e){return e.id===t})[0];if(void 0!==e&&void 0!==O.imageList[e.info.image]){if(O.imageList[e.info.image].deferred&&!O.imageList[e.info.image].deferredStart){O.imageList[e.info.image].deferredStart=!0;var i=O.data.images.filter(function(t){return t.id===e.info.image})[0];void 0!==i&&c(i,e.info.image,!1)}if(void 0!==O.imageList[e.info.image].imageData&&void 0!=O.imageList[e.info.image]){var a={x:O.imageList[e.info.image].imageData.naturalWidth/2,y:O.imageList[e.info.image].imageData.naturalHeight/2};e.info.blend&&(O.context.globalCompositeOperation=e.info.blend),e.pList.forEach(function(t){e.info.keepalive||t.life.current--,t.position={x:t.position.x+t.dirNorm.x*t.speed.position,y:t.position.y+t.dirNorm.y*t.speed.position};var i=t.scale,o=t.life.max-t.life.current,n=o/t.life.max,r=1;100*n<e.info.pParams.fade.in&&(r=o/(t.life.max*(.01*e.info.pParams.fade.in))),100*n>e.info.pParams.fade.out&&(r=t.life.current/(t.life.max-t.life.max*(.01*e.info.pParams.fade.out)));var s={x:parseInt(t.position.x),y:parseInt(t.position.y)};t.rotation+=t.speed.rotation,O.context.save(),O.context.translate(s.x,s.y),O.context.globalAlpha=r,O.context.rotate(t.rotation),O.context.drawImage(O.imageList[e.info.image].imageData,-a.x*i,-a.y*i,O.imageList[e.info.image].imageData.naturalWidth*i,O.imageList[e.info.image].imageData.naturalHeight*i),O.context.restore(),O.context.globalAlpha=1}),e.pList=e.pList.filter(function(t){return t.life.current>0}),O.context.globalCompositeOperation="source-over"}}},getSystem:function(t){return W.pSystemList.filter(function(e){return e.id===t})[0]},update:function(){W.pSystemList.forEach(function(t,e,i){if(v(t.info),t.time.now=Date.now(),t.time.diff=t.time.now-t.time.prev,t.time.total=t.time.now-t.time.start,t.time.diff>1e3/t.info.emitRate&&t.info.emitCounter>t.time.total){var a=1;"burst"===t.info.genType&&(a=t.info.emitRate),t.time.prev=t.time.now;for(var o=0;o<a;o++){var n={x:t.position.current.x,y:t.position.current.y};if(t.info.emitterSize>1){var r=2*Math.PI*M(0,1),s=M(0,1)+M(0,1),c=s>1?2-s:s;n={x:(c*=t.info.emitterSize)*Math.cos(r)+n.x,y:c*Math.sin(r)+n.y}}isNaN(t.info.emitDirStart)&&(t.info.emitDirStart=0),isNaN(t.info.emitDirEnd)&&(t.info.emitDirEnd=0);var d=0,l=N(M(t.info.emitDirStart-90,t.info.emitDirEnd-90));t.info.faceMotion&&(d=l,t.info.faceAngle&&(d+=N(t.info.faceAngle)));var u={x:Math.cos(l),y:Math.sin(l)},f=M(t.info.pParams.scale.min,t.info.pParams.scale.max),p=T(t.info.pParams.life.min,t.info.pParams.life.max),m={position:M(t.info.pParams.speed.position.min,t.info.pParams.speed.position.max),rotation:M(t.info.pParams.speed.rotation.min,t.info.pParams.speed.rotation.max)},y=L(u),g={position:{x:0,y:0},scale:1,rotation:0};void 0!==t.info.parent&&void 0!==t.info.parent.object&&(g.position={x:t.info.parent.object.position.current.x,y:t.info.parent.object.position.current.y}),n={x:n.x+g.position.x,y:n.y+g.position.y},t.pList.push({position:n,rotation:d,dirNorm:y,scale:f,speed:m,life:{max:p,current:p}})}}t.time.total>t.info.emitCounter&&!t.info.keepalive&&0===t.pList.length&&i.splice(e,1)})}};document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState?O.paused=!0:O.paused=!1},!1),"file"==i?function(t,e){var i=t;i+="?"+(new Date).getTime();var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&e(JSON.parse(a.responseText)),404==a.status&&console.error("JSON Load Error: "+a.statusText+" "+a.readyState)},a.overrideMimeType("application/json"),a.open("GET",i,!0),a.send(null)}(e,o):o("string"==i?JSON.parse(e):e),this.external=function(t){O.external=!0,t.forEach(function(t){"selectonly"===t.command&&(O.mode="click",void 0!==x(t.item)&&O.actionList.push({mode:"click",obj:x(t.item)}))})},this.report=function(t){console.log(O[t])},this.export=function(){return O.data}}